<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Image Resizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./styles.css">
    <!-- Vue 3 CDN (global build) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  </head>
  <body>
    <div id="app" class="app-root">
      <header class="app-header">
        <h1>
          Image Resizer</h1>
        <p class="app-subtitle">Resize images with presets, fit/fill, and background control.</p>
      </header>

      <main class="app-main">
        <section class="controls-panel">
          <div class="panel-section">
            <h2>1. Upload image</h2>
            <div
              class="dropzone"
              :class="{ 'dropzone--active': isDragOver }"
              @dragover.prevent="onDragOver"
              @dragleave.prevent="onDragLeave"
              @drop.prevent="onDrop"
            >
              <p v-if="!imageLoaded">Drag &amp; drop or paste an image here</p>
              <p v-else>Drop or paste a new image to replace</p>
              <button type="button" class="btn" @click="onBrowseClick">Browse…</button>
              <input
                ref="fileInput"
                type="file"
                accept="image/*"
                class="file-input"
                autocomplete="off"
                @change="onFileChange"
              >
            </div>
            <div class="meta-row" v-if="srcWidth && srcHeight">
              <span class="meta-label">Original:</span>
              <span>{{ srcWidth }} × {{ srcHeight }} px</span>
            </div>
          </div>

          <div class="panel-section">
            <h2>2. Target size &amp; format</h2>
            <div class="form-row">
              <label>
                Width
                <input
                  type="number"
                  min="1"
                  max="8000"
                  autocomplete="off"
                  v-model.number="targetWidth"
                >
              </label>
              <label>
                Height
                <input
                  type="number"
                  min="1"
                  max="8000"
                  autocomplete="off"
                  v-model.number="targetHeight"
                >
              </label>
            </div>
            <div class="form-row">
              <label>
                Format
                <select v-model="targetFormat">
                  <option value="image/png">PNG</option>
                  <option value="image/jpeg">JPG</option>
                  <option value="image/webp">WEBP</option>
                </select>
              </label>
            </div>
            <div class="form-row">
              <fieldset class="fieldset-inline">
                <legend>Aspect mode</legend>
                <label>
                  <input type="radio" value="fit" v-model="aspectMode">
                  Fit
                </label>
                <label>
                  <input type="radio" value="fill" v-model="aspectMode">
                  Fill
                </label>
              </fieldset>
            </div>
            <div class="form-row">
              <fieldset class="fieldset-inline">
                <legend>Background</legend>
                <label>
                  <input type="radio" value="transparent" v-model="backgroundMode">
                  Transparent
                </label>
                <label>
                  <input type="radio" value="color" v-model="backgroundMode">
                  Color
                </label>
              </fieldset>
            </div>
            <div class="form-row" v-if="backgroundMode === 'color'">
              <label>
                Color
                <input type="color" v-model="backgroundColor" autocomplete="off">
              </label>
              <button
                type="button"
                class="btn btn-secondary"
                :disabled="!imageLoaded"
                @click="startEyedropper"
              >
                {{ isPickingColor ? 'Click canvas…' : 'Pick from image' }}
              </button>
            </div>
          </div>

          <div class="panel-section">
            <h2>3. Presets</h2>
            <div class="form-row">
              <input
                type="text"
                v-model="presetName"
                placeholder="Preset name (e.g. Facebook banner)"
                autocomplete="off"
              >
              <button
                type="button"
                class="btn"
                :disabled="!presetName.trim()"
                @click="savePreset"
              >
                Save
              </button>
            </div>
            <div class="presets-list" v-if="presets.length">
              <div
                v-for="preset in presets"
                :key="preset.name"
                class="preset-item"
              >
                <button
                  type="button"
                  class="preset-apply"
                  @click="applyPreset(preset)"
                >
                  <span class="preset-name">{{ preset.name }}</span>
                  <span class="preset-meta">
                    {{ preset.width }}×{{ preset.height }},
                    {{ formatLabel(preset.format) }}
                  </span>
                </button>
                <button
                  type="button"
                  class="preset-delete"
                  @click="deletePreset(preset)"
                  aria-label="Delete preset"
                >
                  ✕
                </button>
              </div>
            </div>
            <p v-else class="empty-text">No presets yet.</p>
          </div>
        </section>

        <section class="preview-panel">
          <div class="preview-header">
            <h2>Preview</h2>
            <div class="meta-row" v-if="targetWidth && targetHeight">
              <span class="meta-label">Target:</span>
              <span>{{ targetWidth }} × {{ targetHeight }} px</span>
            </div>
          </div>

          <div
            class="canvas-wrapper"
            :class="{ 'canvas-wrapper--picking': isPickingColor }"
          >
            <div class="canvas-aspect" :style="canvasAspectStyle">
              <canvas
                ref="canvas"
                class="preview-canvas"
                @click="onCanvasClick"
              ></canvas>
            </div>
            <p v-if="!imageLoaded" class="empty-text">
              Upload an image to see the preview.
            </p>
          </div>

          <button
            type="button"
            class="btn btn-primary download-btn"
            :disabled="!imageLoaded"
            @click="downloadImage"
          >
            Download image
          </button>
        </section>
      </main>
    </div>

    <script type="module" src="./main.js"></script>
  </body>
</html>
